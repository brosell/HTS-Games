<HTML>
<HEAD>
<TITLE>
UISystem.cpp
</TITLE>
</HEAD>
<BODY>
<PRE>
<font color="blue">#pragma</font> <font color="blue">warning</font> <font color="black">(</font>disable<font color="black">:</font> <font color="maroon">4786</font><font color="black">)</font>
<font color="blue">#include</font> <font color="maroon">"UISystem.h"</font>
<font color="blue">#include</font> <font color="maroon">"Log.h"</font>

UISystem<font color="black">:</font><font color="black">:</font>UISystem<font color="black">(</font><font color="black">)</font><font color="black">:</font> 
Container<font color="black">(</font><font color="black">)</font>,
m_firstChanceDelegate<font color="black">(</font><font color="maroon">0</font><font color="black">)</font>
<font color="black">{</font>

<font color="black">}</font>

UISystem<font color="black">:</font><font color="black">:</font>initialize<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
<font color="black">}</font>

<font color="green">/** 
  * Many event handlers to be overridden.
  */</font>

<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onMousePress<font color="black">(</font>MousePressEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font>
  <font color="green">// let any first chancers have a wack at it</font>
  UIThing<font color="black">:</font><font color="black">:</font>onMousePress<font color="black">(</font>event<font color="black">)</font>;
  DialogBox<font color="black">*</font> db <font color="black">=</font> <font color="black">(</font>m_modalStack.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font>?m_modalStack.back<font color="black">(</font><font color="black">)</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>db <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
  <font color="black">{</font>
    Rect r <font color="black">=</font> db<font color="black">-</font><font color="black">&#62;</font>getTranslatedPosition<font color="black">(</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>r.containsPoint<font color="black">(</font>Point<font color="black">(</font>event<font color="black">-</font><font color="black">&#62;</font>x, event<font color="black">-</font><font color="black">&#62;</font>y<font color="black">)</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
      db<font color="black">-</font><font color="black">&#62;</font>onMousePress<font color="black">(</font>event<font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">else</font>
    <font color="black">{</font>
      <font color="green">// maybe set the mouse to an hourglass?</font>
    <font color="black">}</font>
  <font color="black">}</font>
  <font color="blue">else</font>
  <font color="black">{</font>
    Container<font color="black">:</font><font color="black">:</font>onMousePress<font color="black">(</font>event<font color="black">)</font>;
  <font color="black">}</font>
<font color="black">}</font>

<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onMouseRelease<font color="black">(</font>MouseReleaseEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font> 
    <font color="green">// let any first chancers have a wack at it</font>
  UIThing<font color="black">:</font><font color="black">:</font>onMouseRelease<font color="black">(</font>event<font color="black">)</font>;
  DialogBox<font color="black">*</font> db <font color="black">=</font> <font color="black">(</font>m_modalStack.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font>?m_modalStack.back<font color="black">(</font><font color="black">)</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>db <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
  <font color="black">{</font>
    Rect r <font color="black">=</font> db<font color="black">-</font><font color="black">&#62;</font>getTranslatedPosition<font color="black">(</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>r.containsPoint<font color="black">(</font>Point<font color="black">(</font>event<font color="black">-</font><font color="black">&#62;</font>x, event<font color="black">-</font><font color="black">&#62;</font>y<font color="black">)</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
      db<font color="black">-</font><font color="black">&#62;</font>onMouseRelease<font color="black">(</font>event<font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">else</font>
    <font color="black">{</font>
      <font color="green">// maybe set the mouse to an hourglass?</font>
    <font color="black">}</font>
  <font color="black">}</font>
  <font color="blue">else</font>
  <font color="black">{</font>
    Container<font color="black">:</font><font color="black">:</font>onMouseRelease<font color="black">(</font>event<font color="black">)</font>;
  <font color="black">}</font>

<font color="black">}</font>
<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onMouseClick<font color="black">(</font>MouseClickEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font>
    <font color="green">// let any first chancers have a wack at it</font>
  UIThing<font color="black">:</font><font color="black">:</font>onMouseClick<font color="black">(</font>event<font color="black">)</font>;
  DialogBox<font color="black">*</font> db <font color="black">=</font> <font color="black">(</font>m_modalStack.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font>?m_modalStack.back<font color="black">(</font><font color="black">)</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>db <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
  <font color="black">{</font>
    Rect r <font color="black">=</font> db<font color="black">-</font><font color="black">&#62;</font>getTranslatedPosition<font color="black">(</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>r.containsPoint<font color="black">(</font>Point<font color="black">(</font>event<font color="black">-</font><font color="black">&#62;</font>x, event<font color="black">-</font><font color="black">&#62;</font>y<font color="black">)</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
      db<font color="black">-</font><font color="black">&#62;</font>onMouseClick<font color="black">(</font>event<font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">else</font>
    <font color="black">{</font>
      <font color="green">// maybe set the mouse to an hourglass?</font>
    <font color="black">}</font>
  <font color="black">}</font>
  <font color="blue">else</font>
  <font color="black">{</font>
    Container<font color="black">:</font><font color="black">:</font>onMouseClick<font color="black">(</font>event<font color="black">)</font>;
  <font color="black">}</font>
<font color="black">}</font>

<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onMouseDblClick<font color="black">(</font>MouseDblClickEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font> 
    <font color="green">// let any first chancers have a wack at it</font>
  UIThing<font color="black">:</font><font color="black">:</font>onMouseDblClick<font color="black">(</font>event<font color="black">)</font>;
  DialogBox<font color="black">*</font> db <font color="black">=</font> <font color="black">(</font>m_modalStack.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font>?m_modalStack.back<font color="black">(</font><font color="black">)</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>db <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
  <font color="black">{</font>
    Rect r <font color="black">=</font> db<font color="black">-</font><font color="black">&#62;</font>getTranslatedPosition<font color="black">(</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>r.containsPoint<font color="black">(</font>Point<font color="black">(</font>event<font color="black">-</font><font color="black">&#62;</font>x, event<font color="black">-</font><font color="black">&#62;</font>y<font color="black">)</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
      db<font color="black">-</font><font color="black">&#62;</font>onMouseDblClick<font color="black">(</font>event<font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">else</font>
    <font color="black">{</font>
      <font color="green">// maybe set the mouse to an hourglass?</font>
    <font color="black">}</font>
  <font color="black">}</font>
  <font color="blue">else</font>
  <font color="black">{</font>
    Container<font color="black">:</font><font color="black">:</font>onMouseDblClick<font color="black">(</font>event<font color="black">)</font>;
  <font color="black">}</font>
<font color="black">}</font>
<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onMouseMove<font color="black">(</font>MouseMoveEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font> 
  <font color="green">// let any first chancers have a wack at it</font>
  UIThing<font color="black">:</font><font color="black">:</font>onMouseMove<font color="black">(</font>event<font color="black">)</font>;
  DialogBox<font color="black">*</font> db <font color="black">=</font> <font color="black">(</font>m_modalStack.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font>?m_modalStack.back<font color="black">(</font><font color="black">)</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>db <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
  <font color="black">{</font>
    Rect r <font color="black">=</font> db<font color="black">-</font><font color="black">&#62;</font>getTranslatedPosition<font color="black">(</font><font color="black">)</font>;
    <font color="blue">if</font> <font color="black">(</font>r.containsPoint<font color="black">(</font>Point<font color="black">(</font>event<font color="black">-</font><font color="black">&#62;</font>x, event<font color="black">-</font><font color="black">&#62;</font>y<font color="black">)</font><font color="black">)</font><font color="black">)</font>
    <font color="black">{</font>
      db<font color="black">-</font><font color="black">&#62;</font>onMouseMove<font color="black">(</font>event<font color="black">)</font>;
    <font color="black">}</font>
    <font color="blue">else</font>
    <font color="black">{</font>
      <font color="green">// maybe set the mouse to an hourglass?</font>
    <font color="black">}</font>
  <font color="black">}</font>
  <font color="blue">else</font>
  <font color="black">{</font>
    Container<font color="black">:</font><font color="black">:</font>onMouseMove<font color="black">(</font>event<font color="black">)</font>;
  <font color="black">}</font>
<font color="black">}</font>
<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onMouseEnter<font color="black">(</font>MouseEnterEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font> 
  <font color="green">//lassert(false);</font>
  <font color="green">// not at this scope?</font>
<font color="black">}</font>
<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onMouseExit<font color="black">(</font>MouseExitEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font> 
  <font color="green">//lassert(false);</font>
  <font color="green">// not at this scope?</font>
<font color="black">}</font>

<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onKeyPress<font color="black">(</font>KeyPressEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font> 
  <font color="green">// let any first chancers have a wack at it</font>
  UIThing<font color="black">:</font><font color="black">:</font>onKeyPress<font color="black">(</font>event<font color="black">)</font>;
  DialogBox<font color="black">*</font> db <font color="black">=</font> <font color="black">(</font>m_modalStack.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font>?m_modalStack.back<font color="black">(</font><font color="black">)</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>db <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
  <font color="black">{</font>
    db<font color="black">-</font><font color="black">&#62;</font>onKeyPress<font color="black">(</font>event<font color="black">)</font>;
  <font color="black">}</font>
  <font color="blue">else</font>
  <font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font>m_things.size<font color="black">(</font><font color="black">)</font> <font color="black">&#62;</font> <font color="maroon">0</font><font color="black">)</font>
    <font color="black">{</font>
      UIThing<font color="black">*</font> top <font color="black">=</font> m_things.back<font color="black">(</font><font color="black">)</font>;
      <font color="blue">if</font> <font color="black">(</font>top <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
      <font color="black">{</font>
        top<font color="black">-</font><font color="black">&#62;</font>onKeyPress<font color="black">(</font>event<font color="black">)</font>;
      <font color="black">}</font>
    <font color="black">}</font>
  <font color="black">}</font>
<font color="black">}</font>
<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>onKeyRelease<font color="black">(</font>KeyReleaseEvent<font color="black">*</font> event<font color="black">)</font> 
<font color="black">{</font>
  <font color="green">// let any first chancers have a wack at it</font>
  UIThing<font color="black">:</font><font color="black">:</font>onKeyRelease<font color="black">(</font>event<font color="black">)</font>;
  DialogBox<font color="black">*</font> db <font color="black">=</font> <font color="black">(</font>m_modalStack.size<font color="black">(</font><font color="black">)</font><font color="black">&#62;</font><font color="maroon">0</font>?m_modalStack.back<font color="black">(</font><font color="black">)</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>db <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
  <font color="black">{</font>
    db<font color="black">-</font><font color="black">&#62;</font>onKeyRelease<font color="black">(</font>event<font color="black">)</font>;
  <font color="black">}</font>
  <font color="blue">else</font>
  <font color="black">{</font>
    <font color="blue">if</font> <font color="black">(</font>m_things.size<font color="black">(</font><font color="black">)</font> <font color="black">&#62;</font> <font color="maroon">0</font><font color="black">)</font>
    <font color="black">{</font>
      UIThing<font color="black">*</font> top <font color="black">=</font> m_things.back<font color="black">(</font><font color="black">)</font>;
      <font color="blue">if</font> <font color="black">(</font>top <font color="black">!</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
      <font color="black">{</font>
        top<font color="black">-</font><font color="black">&#62;</font>onKeyRelease<font color="black">(</font>event<font color="black">)</font>;
      <font color="black">}</font>
    <font color="black">}</font>
  <font color="black">}</font>
<font color="black">}</font>  


<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>draw<font color="black">(</font>Display<font color="black">*</font> surface<font color="black">)</font>
<font color="black">{</font>
  deque<font color="black">&#60;</font>DialogBox<font color="black">*</font><font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>iterator i;
  list<font color="black">&#60;</font>UIThing<font color="black">*</font><font color="black">&#62;</font><font color="black">:</font><font color="black">:</font>reverse_iterator ri;
  ri <font color="black">=</font> m_things.rbegin<font color="black">(</font><font color="black">)</font>;
  <font color="blue">if</font> <font color="black">(</font>ri<font color="black">!</font><font color="black">=</font>m_things.rend<font color="black">(</font><font color="black">)</font><font color="black">)</font>
  <font color="black">{</font>
    UIThing<font color="black">*</font> thing <font color="black">=</font> <font color="black">*</font>ri;
    thing<font color="black">-</font><font color="black">&#62;</font>draw<font color="black">(</font>surface<font color="black">)</font>;
  <font color="black">}</font>

  <font color="blue">for</font> <font color="black">(</font>i<font color="black">=</font>m_modalStack.begin<font color="black">(</font><font color="black">)</font>; i<font color="black">!</font><font color="black">=</font>m_modalStack.end<font color="black">(</font><font color="black">)</font>; i<font color="black">+</font><font color="black">+</font><font color="black">)</font>
  <font color="black">{</font>
    <font color="black">(</font><font color="black">*</font>i<font color="black">)</font><font color="black">-</font><font color="black">&#62;</font>draw<font color="black">(</font>surface<font color="black">)</font>;
  <font color="black">}</font>
<font color="black">}</font>

<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>pushModal<font color="black">(</font>DialogBox<font color="black">*</font> cont<font color="black">)</font>
<font color="black">{</font>
  m_modalStack.push_back<font color="black">(</font>cont<font color="black">)</font>;
<font color="black">}</font>

<font color="blue">void</font> UISystem<font color="black">:</font><font color="black">:</font>popModal<font color="black">(</font><font color="black">)</font>
<font color="black">{</font>
  m_modalStack.pop_back<font color="black">(</font><font color="black">)</font>;
<font color="black">}</font>




</PRE>
</BODY>
</HTML>
